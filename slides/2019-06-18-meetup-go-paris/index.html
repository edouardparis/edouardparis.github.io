<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<title>Meetup Go 2019-06-18</title>
<meta name=description content="Edouard Paris personal website">
<meta name=apple-mobile-web-app-capable content="yes">
<meta name=apple-mobile-web-app-status-bar-style content="black-translucent">
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<link rel=stylesheet href=/reveal-js/css/reveal.css><link rel=stylesheet href=/css/slides.css id=theme><link rel=stylesheet href=/highlight-js/vs.min.css>
</head>
<body>
<div class=reveal>
<div class=slides>
<h1 id=connect-yourself-to-the-lightning-network-with-go>Connect yourself to the lightning network with Go</h1>
<p>An example with LND and lntop</p>
<p>Edouard Paris - <a href=https://edouard.paris/slides/2019-06-18-meetup-go-paris>https://edouard.paris/slides/2019-06-18-meetup-go-paris</a></p>
<hr>
<hr>
<hr>
<p>import (
"io/ioutil"
"net/url"</p>
<pre><code>&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;github.com/pkg/errors&amp;#34;&lt;/span&gt;
&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;google.golang.org/grpc&amp;#34;&lt;/span&gt;
&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;google.golang.org/grpc/credentials&amp;#34;&lt;/span&gt;
&lt;span style=&quot;color:#a6e22e&quot;&gt;macaroon&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;gopkg.in/macaroon.v2&amp;#34;&lt;/span&gt;

&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;github.com/lightningnetwork/lnd/lncfg&amp;#34;&lt;/span&gt;
&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;github.com/lightningnetwork/lnd/macaroons&amp;#34;&lt;/span&gt;
</code></pre>
<p>)</p>
<p>type Config struct {
Address string <code>toml:&amp;#34;address&amp;#34;</code>
Cert string <code>toml:&amp;#34;cert&amp;#34;</code>
Macaroon string <code>toml:&amp;#34;macaroon&amp;#34;</code>
MacaroonTimeOut int64 <code>toml:&amp;#34;macaroon_timeout&amp;#34;</code>
MacaroonIP string <code>toml:&amp;#34;macaroon_ip&amp;#34;</code>
MaxMsgRecvSize int <code>toml:&amp;#34;max_msg_recv_size&amp;#34;</code>
ConnTimeout int <code>toml:&amp;#34;conn_timeout&amp;#34;</code>
}</p>
<p>func NewConn(c <em>Config) (</em>grpc.ClientConn, error) {
macaroonBytes, err := ioutil.ReadFile(c.Macaroon)
if err != nil {
return nil, err
}</p>
<pre><code>&lt;span style=&quot;color:#a6e22e&quot;&gt;mac&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;:=&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color:#a6e22e&quot;&gt;macaroon&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Macaroon&lt;/span&gt;{}
&lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt; = &lt;span style=&quot;color:#a6e22e&quot;&gt;mac&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;UnmarshalBinary&lt;/span&gt;(&lt;span style=&quot;color:#a6e22e&quot;&gt;macaroonBytes&lt;/span&gt;)
&lt;span style=&quot;color:#66d9ef&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;!=&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;nil&lt;/span&gt; {
	&lt;span style=&quot;color:#66d9ef&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;nil&lt;/span&gt;, &lt;span style=&quot;color:#a6e22e&quot;&gt;errors&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;WithStack&lt;/span&gt;(&lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt;)
}

&lt;span style=&quot;color:#a6e22e&quot;&gt;constrainedMac&lt;/span&gt;, &lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;:=&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;macaroons&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;AddConstraints&lt;/span&gt;(&lt;span style=&quot;color:#a6e22e&quot;&gt;mac&lt;/span&gt;,
	&lt;span style=&quot;color:#a6e22e&quot;&gt;macaroons&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;TimeoutConstraint&lt;/span&gt;(&lt;span style=&quot;color:#a6e22e&quot;&gt;c&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;MacaroonTimeOut&lt;/span&gt;),
	&lt;span style=&quot;color:#a6e22e&quot;&gt;macaroons&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;IPLockConstraint&lt;/span&gt;(&lt;span style=&quot;color:#a6e22e&quot;&gt;c&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;MacaroonIP&lt;/span&gt;),
)
&lt;span style=&quot;color:#66d9ef&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;!=&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;nil&lt;/span&gt; {
	&lt;span style=&quot;color:#66d9ef&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;nil&lt;/span&gt;, &lt;span style=&quot;color:#a6e22e&quot;&gt;errors&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;WithStack&lt;/span&gt;(&lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt;)
}

&lt;span style=&quot;color:#a6e22e&quot;&gt;cred&lt;/span&gt;, &lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;:=&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;credentials&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;NewClientTLSFromFile&lt;/span&gt;(&lt;span style=&quot;color:#a6e22e&quot;&gt;c&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Cert&lt;/span&gt;, &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&amp;#34;&lt;/span&gt;)
&lt;span style=&quot;color:#66d9ef&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;!=&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;nil&lt;/span&gt; {
	&lt;span style=&quot;color:#66d9ef&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;nil&lt;/span&gt;, &lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt;
}

&lt;span style=&quot;color:#a6e22e&quot;&gt;u&lt;/span&gt;, &lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;:=&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;url&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Parse&lt;/span&gt;(&lt;span style=&quot;color:#a6e22e&quot;&gt;c&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Address&lt;/span&gt;)
&lt;span style=&quot;color:#66d9ef&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;!=&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;nil&lt;/span&gt; {
	&lt;span style=&quot;color:#66d9ef&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;nil&lt;/span&gt;, &lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt;
}

&lt;span style=&quot;color:#a6e22e&quot;&gt;conn&lt;/span&gt;, &lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;:=&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;grpc&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Dial&lt;/span&gt;(&lt;span style=&quot;color:#a6e22e&quot;&gt;u&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Hostname&lt;/span&gt;(),
	&lt;span style=&quot;color:#a6e22e&quot;&gt;grpc&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;WithTransportCredentials&lt;/span&gt;(&lt;span style=&quot;color:#a6e22e&quot;&gt;cred&lt;/span&gt;),
	&lt;span style=&quot;color:#a6e22e&quot;&gt;grpc&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;WithPerRPCCredentials&lt;/span&gt;(&lt;span style=&quot;color:#a6e22e&quot;&gt;macaroons&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;NewMacaroonCredential&lt;/span&gt;(&lt;span style=&quot;color:#a6e22e&quot;&gt;constrainedMac&lt;/span&gt;)),
	&lt;span style=&quot;color:#a6e22e&quot;&gt;grpc&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;WithDialer&lt;/span&gt;(&lt;span style=&quot;color:#a6e22e&quot;&gt;lncfg&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;ClientAddressDialer&lt;/span&gt;(&lt;span style=&quot;color:#a6e22e&quot;&gt;u&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Port&lt;/span&gt;())),
	&lt;span style=&quot;color:#a6e22e&quot;&gt;grpc&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;WithDefaultCallOptions&lt;/span&gt;(&lt;span style=&quot;color:#a6e22e&quot;&gt;grpc&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;MaxCallRecvMsgSize&lt;/span&gt;(&lt;span style=&quot;color:#a6e22e&quot;&gt;c&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;MaxMsgRecvSize&lt;/span&gt;)),
)
&lt;span style=&quot;color:#66d9ef&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;!=&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;nil&lt;/span&gt; {
	&lt;span style=&quot;color:#66d9ef&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;nil&lt;/span&gt;, &lt;span style=&quot;color:#a6e22e&quot;&gt;errors&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;WithStack&lt;/span&gt;(&lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt;)
}

&lt;span style=&quot;color:#66d9ef&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;conn&lt;/span&gt;, &lt;span style=&quot;color:#66d9ef&quot;&gt;nil&lt;/span&gt;
</code></pre>
<p>}
</p>
<hr>
<h2 id=lntop>LNTOP</h2>
<p><a href=https://github.com/edouardparis/lntop>https://github.com/edouardparis/lntop</a>
<img src=lntop-v0.1.0.png alt=lntop-v0.1.0></p>
<hr>
<p><img src=archi.svg alt=architecture></p>
<hr>
<p>type Pool struct {
conns chan Conn
factory Factory
mu sync.RWMutex
timeout time.Duration
}</p>
<p>func (p <em>Pool) Get(ctx context.Context) (</em>Conn, error) {
p.mu.Lock()
conns := p.conns
p.mu.Unlock()</p>
<pre><code>&lt;span style=&quot;color:#66d9ef&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;conns&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;==&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;nil&lt;/span&gt; {
	&lt;span style=&quot;color:#66d9ef&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;nil&lt;/span&gt;, &lt;span style=&quot;color:#a6e22e&quot;&gt;ErrClosed&lt;/span&gt;
}

&lt;span style=&quot;color:#a6e22e&quot;&gt;conn&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;:=&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;Conn&lt;/span&gt;{
	&lt;span style=&quot;color:#a6e22e&quot;&gt;pool&lt;/span&gt;: &lt;span style=&quot;color:#a6e22e&quot;&gt;p&lt;/span&gt;,
}

&lt;span style=&quot;color:#66d9ef&quot;&gt;select&lt;/span&gt; {
&lt;span style=&quot;color:#66d9ef&quot;&gt;case&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;conn&lt;/span&gt; = &lt;span style=&quot;color:#f92672&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span style=&quot;color:#a6e22e&quot;&gt;conns&lt;/span&gt;:
&lt;span style=&quot;color:#66d9ef&quot;&gt;case&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span style=&quot;color:#a6e22e&quot;&gt;ctx&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Done&lt;/span&gt;():
	&lt;span style=&quot;color:#66d9ef&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;nil&lt;/span&gt;, &lt;span style=&quot;color:#a6e22e&quot;&gt;ErrTimeout&lt;/span&gt;
}

&lt;span style=&quot;color:#66d9ef&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;conn&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;ClientConn&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;!=&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;nil&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;
	&lt;span style=&quot;color:#a6e22e&quot;&gt;p&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;timeout&lt;/span&gt; &amp;gt; &lt;span style=&quot;color:#ae81ff&quot;&gt;0&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;
	&lt;span style=&quot;color:#a6e22e&quot;&gt;conn&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;usedAt&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Add&lt;/span&gt;(&lt;span style=&quot;color:#a6e22e&quot;&gt;p&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;timeout&lt;/span&gt;).&lt;span style=&quot;color:#a6e22e&quot;&gt;Before&lt;/span&gt;(&lt;span style=&quot;color:#a6e22e&quot;&gt;time&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Now&lt;/span&gt;()) {
	&lt;span style=&quot;color:#a6e22e&quot;&gt;conn&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;ClientConn&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Close&lt;/span&gt;()
	&lt;span style=&quot;color:#a6e22e&quot;&gt;conn&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;ClientConn&lt;/span&gt; = &lt;span style=&quot;color:#66d9ef&quot;&gt;nil&lt;/span&gt;
}

&lt;span style=&quot;color:#66d9ef&quot;&gt;var&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;error&lt;/span&gt;
&lt;span style=&quot;color:#66d9ef&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;conn&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;ClientConn&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;==&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;nil&lt;/span&gt; {
	&lt;span style=&quot;color:#a6e22e&quot;&gt;conn&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;ClientConn&lt;/span&gt;, &lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt; = &lt;span style=&quot;color:#a6e22e&quot;&gt;p&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;factory&lt;/span&gt;()
	&lt;span style=&quot;color:#66d9ef&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;!=&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;nil&lt;/span&gt; {
		&lt;span style=&quot;color:#a6e22e&quot;&gt;conns&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;Conn&lt;/span&gt;{
			&lt;span style=&quot;color:#a6e22e&quot;&gt;pool&lt;/span&gt;: &lt;span style=&quot;color:#a6e22e&quot;&gt;p&lt;/span&gt;,
		}
	}
}

&lt;span style=&quot;color:#66d9ef&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color:#a6e22e&quot;&gt;conn&lt;/span&gt;, &lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt;
</code></pre>
<p>}</p>
<p>func (p *Pool) Close() {
p.mu.Lock()
conns := p.conns
p.conns = nil
p.mu.Unlock()</p>
<pre><code>&lt;span style=&quot;color:#66d9ef&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;conns&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;==&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;nil&lt;/span&gt; {
	&lt;span style=&quot;color:#66d9ef&quot;&gt;return&lt;/span&gt;
}

close(&lt;span style=&quot;color:#a6e22e&quot;&gt;conns&lt;/span&gt;)
&lt;span style=&quot;color:#66d9ef&quot;&gt;for&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;i&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;:=&lt;/span&gt; &lt;span style=&quot;color:#ae81ff&quot;&gt;0&lt;/span&gt;; &lt;span style=&quot;color:#a6e22e&quot;&gt;i&lt;/span&gt; &amp;lt; &lt;span style=&quot;color:#a6e22e&quot;&gt;p&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Capacity&lt;/span&gt;(); &lt;span style=&quot;color:#a6e22e&quot;&gt;i&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;++&lt;/span&gt; {
	&lt;span style=&quot;color:#a6e22e&quot;&gt;client&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;:=&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span style=&quot;color:#a6e22e&quot;&gt;conns&lt;/span&gt;
	&lt;span style=&quot;color:#66d9ef&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;client&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;ClientConn&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;==&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;nil&lt;/span&gt; {
		&lt;span style=&quot;color:#66d9ef&quot;&gt;continue&lt;/span&gt;
	}
	&lt;span style=&quot;color:#a6e22e&quot;&gt;client&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;ClientConn&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Close&lt;/span&gt;()
}
</code></pre>
<p>}
</p>
<p>import (
"time"</p>
<pre><code>&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;google.golang.org/grpc&amp;#34;&lt;/span&gt;
</code></pre>
<p>)</p>
<p>type Conn struct {
<em>grpc.ClientConn
pool </em>Pool
usedAt time.Time
}</p>
<p>func (c *Conn) Close() error {
if c == nil {
return nil
}
if c.ClientConn == nil {
return ErrAlreadyClosed
}
if c.pool.IsClosed() {
return ErrClosed
}</p>
<pre><code>&lt;span style=&quot;color:#a6e22e&quot;&gt;conn&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;:=&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;Conn&lt;/span&gt;{
	&lt;span style=&quot;color:#a6e22e&quot;&gt;pool&lt;/span&gt;:       &lt;span style=&quot;color:#a6e22e&quot;&gt;c&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;pool&lt;/span&gt;,
	&lt;span style=&quot;color:#a6e22e&quot;&gt;ClientConn&lt;/span&gt;: &lt;span style=&quot;color:#a6e22e&quot;&gt;c&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;ClientConn&lt;/span&gt;,
}
&lt;span style=&quot;color:#66d9ef&quot;&gt;select&lt;/span&gt; {
&lt;span style=&quot;color:#66d9ef&quot;&gt;case&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;c&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;pool&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;conns&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;conn&lt;/span&gt;:
&lt;span style=&quot;color:#66d9ef&quot;&gt;default&lt;/span&gt;:
	&lt;span style=&quot;color:#66d9ef&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;ErrFullPool&lt;/span&gt;
}
&lt;span style=&quot;color:#66d9ef&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;nil&lt;/span&gt;
</code></pre>
<p>}
</p>
<hr>
<p>import (
"context"
"sync"</p>
<pre><code>&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;github.com/edouardparis/lntop/events&amp;#34;&lt;/span&gt;
&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;github.com/edouardparis/lntop/logging&amp;#34;&lt;/span&gt;
&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;github.com/edouardparis/lntop/network&amp;#34;&lt;/span&gt;
&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;github.com/edouardparis/lntop/network/models&amp;#34;&lt;/span&gt;
</code></pre>
<p>)</p>
<p>type PubSub struct {
stop chan bool
logger logging.Logger
network <em>network.Network
wg </em>sync.WaitGroup
}</p>
<p>func New(logger logging.Logger, network <em>network.Network) </em>PubSub {
return &PubSub{
logger: logger.With(logging.String("logger", "pubsub")),
network: network,
wg: &sync.WaitGroup{},
stop: make(chan bool),
}
}</p>
<p></p>
<pre><code>&lt;span style=&quot;color:#66d9ef&quot;&gt;go&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;func&lt;/span&gt;() {
	&lt;span style=&quot;color:#66d9ef&quot;&gt;for&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;invoice&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;:=&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;range&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;invoices&lt;/span&gt; {
		&lt;span style=&quot;color:#a6e22e&quot;&gt;p&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;logger&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Debug&lt;/span&gt;(&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;received invoice&amp;#34;&lt;/span&gt;, &lt;span style=&quot;color:#a6e22e&quot;&gt;logging&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Object&lt;/span&gt;(&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;invoice&amp;#34;&lt;/span&gt;, &lt;span style=&quot;color:#a6e22e&quot;&gt;invoice&lt;/span&gt;))
		&lt;span style=&quot;color:#66d9ef&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;invoice&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Settled&lt;/span&gt; {
			&lt;span style=&quot;color:#a6e22e&quot;&gt;sub&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;events&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;New&lt;/span&gt;(&lt;span style=&quot;color:#a6e22e&quot;&gt;events&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;InvoiceSettled&lt;/span&gt;)
		} &lt;span style=&quot;color:#66d9ef&quot;&gt;else&lt;/span&gt; {
			&lt;span style=&quot;color:#a6e22e&quot;&gt;sub&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;events&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;New&lt;/span&gt;(&lt;span style=&quot;color:#a6e22e&quot;&gt;events&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;InvoiceCreated&lt;/span&gt;)
		}
	}
	&lt;span style=&quot;color:#a6e22e&quot;&gt;p&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;wg&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Done&lt;/span&gt;()
}()

&lt;span style=&quot;color:#66d9ef&quot;&gt;go&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;func&lt;/span&gt;() {
	&lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;:=&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;p&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;network&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;SubscribeInvoice&lt;/span&gt;(&lt;span style=&quot;color:#a6e22e&quot;&gt;ctx&lt;/span&gt;, &lt;span style=&quot;color:#a6e22e&quot;&gt;invoices&lt;/span&gt;)
	&lt;span style=&quot;color:#66d9ef&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;!=&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;nil&lt;/span&gt; {
		&lt;span style=&quot;color:#a6e22e&quot;&gt;p&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;logger&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Error&lt;/span&gt;(&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;SubscribeInvoice returned an error&amp;#34;&lt;/span&gt;, &lt;span style=&quot;color:#a6e22e&quot;&gt;logging&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Error&lt;/span&gt;(&lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt;))
	}
	&lt;span style=&quot;color:#a6e22e&quot;&gt;p&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;wg&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Done&lt;/span&gt;()
}()

&lt;span style=&quot;color:#66d9ef&quot;&gt;go&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;func&lt;/span&gt;() {
	&lt;span style=&quot;color:#f92672&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span style=&quot;color:#a6e22e&quot;&gt;p&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;stop&lt;/span&gt;
	&lt;span style=&quot;color:#a6e22e&quot;&gt;cancel&lt;/span&gt;()
	close(&lt;span style=&quot;color:#a6e22e&quot;&gt;invoices&lt;/span&gt;)
	&lt;span style=&quot;color:#a6e22e&quot;&gt;p&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;wg&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Done&lt;/span&gt;()
}()
</code></pre>
<p>}</p>
<p></p>
<pre><code>&lt;span style=&quot;color:#a6e22e&quot;&gt;cltInvoices&lt;/span&gt;, &lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;:=&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;clt&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;SubscribeInvoices&lt;/span&gt;(&lt;span style=&quot;color:#a6e22e&quot;&gt;ctx&lt;/span&gt;, &lt;span style=&quot;color:#f92672&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color:#a6e22e&quot;&gt;lnrpc&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;InvoiceSubscription&lt;/span&gt;{})
&lt;span style=&quot;color:#66d9ef&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;!=&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;nil&lt;/span&gt; {
	&lt;span style=&quot;color:#66d9ef&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt;
}

&lt;span style=&quot;color:#66d9ef&quot;&gt;for&lt;/span&gt; {
	&lt;span style=&quot;color:#66d9ef&quot;&gt;select&lt;/span&gt; {
	&lt;span style=&quot;color:#66d9ef&quot;&gt;case&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span style=&quot;color:#a6e22e&quot;&gt;ctx&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Done&lt;/span&gt;():
		&lt;span style=&quot;color:#66d9ef&quot;&gt;break&lt;/span&gt;
	&lt;span style=&quot;color:#66d9ef&quot;&gt;default&lt;/span&gt;:
		&lt;span style=&quot;color:#a6e22e&quot;&gt;invoice&lt;/span&gt;, &lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;:=&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;cltInvoices&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Recv&lt;/span&gt;()
		&lt;span style=&quot;color:#66d9ef&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;!=&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;nil&lt;/span&gt; {
			&lt;span style=&quot;color:#a6e22e&quot;&gt;st&lt;/span&gt;, &lt;span style=&quot;color:#a6e22e&quot;&gt;ok&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;:=&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;status&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;FromError&lt;/span&gt;(&lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt;)
			&lt;span style=&quot;color:#66d9ef&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;ok&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;st&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Code&lt;/span&gt;() &lt;span style=&quot;color:#f92672&quot;&gt;==&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;codes&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Canceled&lt;/span&gt; {
				&lt;span style=&quot;color:#a6e22e&quot;&gt;l&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;logger&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Debug&lt;/span&gt;(&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;stopping subscribe invoice: context canceled&amp;#34;&lt;/span&gt;)
				&lt;span style=&quot;color:#66d9ef&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;nil&lt;/span&gt;
			}
			&lt;span style=&quot;color:#66d9ef&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt;
		}

		&lt;span style=&quot;color:#a6e22e&quot;&gt;channelInvoice&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;lookupInvoiceProtoToInvoice&lt;/span&gt;(&lt;span style=&quot;color:#a6e22e&quot;&gt;invoice&lt;/span&gt;)
	}
}
</code></pre>
<p>}
</p>
<hr>
<p>import (
"fmt"
"log"</p>
<pre><code>&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;github.com/jroimartin/gocui&amp;#34;&lt;/span&gt;
</code></pre>
<p>)</p>
<p>func main() {
g, err := gocui.NewGui(gocui.OutputNormal)
if err != nil {
log.Panicln(err)
}
defer g.Close()</p>
<pre><code>&lt;span style=&quot;color:#a6e22e&quot;&gt;g&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;SetManagerFunc&lt;/span&gt;(&lt;span style=&quot;color:#a6e22e&quot;&gt;layout&lt;/span&gt;)

&lt;span style=&quot;color:#66d9ef&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;:=&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;g&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;SetKeybinding&lt;/span&gt;(&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&amp;#34;&lt;/span&gt;, &lt;span style=&quot;color:#a6e22e&quot;&gt;gocui&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;KeyCtrlC&lt;/span&gt;, &lt;span style=&quot;color:#a6e22e&quot;&gt;gocui&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;ModNone&lt;/span&gt;, &lt;span style=&quot;color:#a6e22e&quot;&gt;quit&lt;/span&gt;); &lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;!=&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;nil&lt;/span&gt; {
	&lt;span style=&quot;color:#a6e22e&quot;&gt;log&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Panicln&lt;/span&gt;(&lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt;)
}

&lt;span style=&quot;color:#66d9ef&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;:=&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;g&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;MainLoop&lt;/span&gt;(); &lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;!=&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;nil&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;!=&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;gocui&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;ErrQuit&lt;/span&gt; {
	&lt;span style=&quot;color:#a6e22e&quot;&gt;log&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Panicln&lt;/span&gt;(&lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt;)
}
</code></pre>
<p>}</p>
<p>func layout(g *gocui.Gui) error {
maxX, maxY := g.Size()
if v, err := g.SetView("hello", maxX/2-7, maxY/2, maxX/2+7, maxY/2+2); err != nil {
if err != gocui.ErrUnknownView {
return err
}
fmt.Fprintln(v, "Hello world!")
}
return nil
}</p>
<p>func quit(g <em>gocui.Gui, v </em>gocui.View) error {
return gocui.ErrQuit
}
</p>
<hr>
<pre><code>&lt;span style=&quot;color:#a6e22e&quot;&gt;c&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;logger&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Debug&lt;/span&gt;(&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;Listening...&amp;#34;&lt;/span&gt;)
&lt;span style=&quot;color:#a6e22e&quot;&gt;refresh&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;:=&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;func&lt;/span&gt;(&lt;span style=&quot;color:#a6e22e&quot;&gt;fn&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;...&lt;/span&gt;&lt;span style=&quot;color:#66d9ef&quot;&gt;func&lt;/span&gt;(&lt;span style=&quot;color:#a6e22e&quot;&gt;context&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Context&lt;/span&gt;) &lt;span style=&quot;color:#66d9ef&quot;&gt;error&lt;/span&gt;) {
	&lt;span style=&quot;color:#66d9ef&quot;&gt;for&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;i&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;:=&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;range&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;fn&lt;/span&gt; {
		&lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;:=&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;fn&lt;/span&gt;[&lt;span style=&quot;color:#a6e22e&quot;&gt;i&lt;/span&gt;](&lt;span style=&quot;color:#a6e22e&quot;&gt;ctx&lt;/span&gt;)
		&lt;span style=&quot;color:#66d9ef&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;!=&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;nil&lt;/span&gt; {
			&lt;span style=&quot;color:#a6e22e&quot;&gt;c&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;logger&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Error&lt;/span&gt;(&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;failed&amp;#34;&lt;/span&gt;, &lt;span style=&quot;color:#a6e22e&quot;&gt;logging&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Error&lt;/span&gt;(&lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt;))
		}
	}
	&lt;span style=&quot;color:#a6e22e&quot;&gt;g&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Update&lt;/span&gt;(&lt;span style=&quot;color:#66d9ef&quot;&gt;func&lt;/span&gt;(&lt;span style=&quot;color:#f92672&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color:#a6e22e&quot;&gt;gocui&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Gui&lt;/span&gt;) &lt;span style=&quot;color:#66d9ef&quot;&gt;error&lt;/span&gt; { &lt;span style=&quot;color:#66d9ef&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;nil&lt;/span&gt; })
}

&lt;span style=&quot;color:#66d9ef&quot;&gt;for&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;event&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;:=&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;range&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;sub&lt;/span&gt; {
	&lt;span style=&quot;color:#a6e22e&quot;&gt;c&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;logger&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Debug&lt;/span&gt;(&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;event received&amp;#34;&lt;/span&gt;,
        &lt;span style=&quot;color:#a6e22e&quot;&gt;logging&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;String&lt;/span&gt;(&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;, &lt;span style=&quot;color:#a6e22e&quot;&gt;event&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Type&lt;/span&gt;))
	&lt;span style=&quot;color:#66d9ef&quot;&gt;switch&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;event&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Type&lt;/span&gt; {
	&lt;span style=&quot;color:#66d9ef&quot;&gt;case&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;events&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;TransactionCreated&lt;/span&gt;:
		&lt;span style=&quot;color:#a6e22e&quot;&gt;refresh&lt;/span&gt;(
			&lt;span style=&quot;color:#a6e22e&quot;&gt;c&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;models&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;RefreshInfo&lt;/span&gt;,
			&lt;span style=&quot;color:#a6e22e&quot;&gt;c&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;models&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;RefreshWalletBalance&lt;/span&gt;,
			&lt;span style=&quot;color:#a6e22e&quot;&gt;c&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;models&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;RefreshTransactions&lt;/span&gt;,
		)
	&lt;span style=&quot;color:#66d9ef&quot;&gt;case&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;events&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;BlockReceived&lt;/span&gt;:
		&lt;span style=&quot;color:#a6e22e&quot;&gt;refresh&lt;/span&gt;(
			&lt;span style=&quot;color:#a6e22e&quot;&gt;c&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;models&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;RefreshInfo&lt;/span&gt;,
			&lt;span style=&quot;color:#a6e22e&quot;&gt;c&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;models&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;RefreshTransactions&lt;/span&gt;,

&lt;span style=&quot;color:#f92672&quot;&gt;...&lt;/span&gt;
</code></pre>
<p></p>
<p>import (
"context"
"sort"
"sync"</p>
<pre><code>&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;github.com/edouardparis/lntop/network/models&amp;#34;&lt;/span&gt;
</code></pre>
<p>)</p>
<p>type TransactionsSort func(<em>models.Transaction, </em>models.Transaction) bool</p>
<p>type Transactions struct {
current <em>models.Transaction
list []</em>models.Transaction
sort TransactionsSort
mu sync.RWMutex
}</p>
<p>func (t <em>Transactions) Current() </em>models.Transaction {
return t.current
}</p>
<p>func (t *Transactions) SetCurrent(index int) {
t.current = t.Get(index)
}</p>
<p>func (t <em>Transactions) List() []</em>models.Transaction {
return t.list
}</p>
<p>func (t *Transactions) Len() int {
return len(t.list)
}</p>
<p>func (t *Transactions) Swap(i, j int) {
t.list[i], t.list[j] = t.list[j], t.list[i]
}</p>
<p>func (t *Transactions) Less(i, j int) bool {
return t.sort(t.list[i], t.list[j])
}</p>
<p>func (t *Transactions) Sort(s TransactionsSort) {
if s == nil {
return
}
t.sort = s
sort.Sort(t)
}</p>
<p>func (t <em>Transactions) Get(index int) </em>models.Transaction {
if index &lt; 0 || index > len(t.list)-1 {
return nil
}</p>
<pre><code>&lt;span style=&quot;color:#66d9ef&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;t&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;list&lt;/span&gt;[&lt;span style=&quot;color:#a6e22e&quot;&gt;index&lt;/span&gt;]
</code></pre>
<p>}</p>
<p>func (t <em>Transactions) Contains(tx </em>models.Transaction) bool {
if tx == nil {
return false
}
for i := range t.list {
if t.list[i].TxHash == tx.TxHash {
return true
}
}
return false
}</p>
<p>func (t <em>Transactions) Add(tx </em>models.Transaction) {
t.mu.Lock()
defer t.mu.Unlock()
if t.Contains(tx) {
return
}
t.list = append(t.list, tx)
if t.sort != nil {
sort.Sort(t)
}
}</p>
<p>func (t <em>Transactions) Update(tx </em>models.Transaction) {
if tx == nil {
return
}
if !t.Contains(tx) {
t.Add(tx)
return
}</p>
<pre><code>&lt;span style=&quot;color:#a6e22e&quot;&gt;t&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;mu&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Lock&lt;/span&gt;()
&lt;span style=&quot;color:#66d9ef&quot;&gt;defer&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;t&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;mu&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Unlock&lt;/span&gt;()

&lt;span style=&quot;color:#66d9ef&quot;&gt;for&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;i&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;:=&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;range&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;t&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;list&lt;/span&gt; {
	&lt;span style=&quot;color:#66d9ef&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;t&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;list&lt;/span&gt;[&lt;span style=&quot;color:#a6e22e&quot;&gt;i&lt;/span&gt;].&lt;span style=&quot;color:#a6e22e&quot;&gt;TxHash&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;==&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;tx&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;TxHash&lt;/span&gt; {
		&lt;span style=&quot;color:#a6e22e&quot;&gt;t&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;list&lt;/span&gt;[&lt;span style=&quot;color:#a6e22e&quot;&gt;i&lt;/span&gt;].&lt;span style=&quot;color:#a6e22e&quot;&gt;NumConfirmations&lt;/span&gt; = &lt;span style=&quot;color:#a6e22e&quot;&gt;tx&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;NumConfirmations&lt;/span&gt;
		&lt;span style=&quot;color:#a6e22e&quot;&gt;t&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;list&lt;/span&gt;[&lt;span style=&quot;color:#a6e22e&quot;&gt;i&lt;/span&gt;].&lt;span style=&quot;color:#a6e22e&quot;&gt;BlockHeight&lt;/span&gt; = &lt;span style=&quot;color:#a6e22e&quot;&gt;tx&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;BlockHeight&lt;/span&gt;
	}
}

&lt;span style=&quot;color:#66d9ef&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;t&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;sort&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;!=&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;nil&lt;/span&gt; {
	&lt;span style=&quot;color:#a6e22e&quot;&gt;sort&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Sort&lt;/span&gt;(&lt;span style=&quot;color:#a6e22e&quot;&gt;t&lt;/span&gt;)
}
</code></pre>
<p>}</p>
<p>func (m *Models) RefreshTransactions(ctx context.Context) error {
transactions, err := m.network.GetTransactions(ctx)
if err != nil {
return err
}</p>
<pre><code>&lt;span style=&quot;color:#66d9ef&quot;&gt;for&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;i&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;:=&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;range&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;transactions&lt;/span&gt; {
	&lt;span style=&quot;color:#a6e22e&quot;&gt;m&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Transactions&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Update&lt;/span&gt;(&lt;span style=&quot;color:#a6e22e&quot;&gt;transactions&lt;/span&gt;[&lt;span style=&quot;color:#a6e22e&quot;&gt;i&lt;/span&gt;])
}

&lt;span style=&quot;color:#66d9ef&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;nil&lt;/span&gt;
</code></pre>
<p>}
</p>
<p>import (
"fmt"</p>
<pre><code>&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;github.com/jroimartin/gocui&amp;#34;&lt;/span&gt;
&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;golang.org/x/text/language&amp;#34;&lt;/span&gt;
&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;golang.org/x/text/message&amp;#34;&lt;/span&gt;

&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;github.com/edouardparis/lntop/ui/color&amp;#34;&lt;/span&gt;
&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;github.com/edouardparis/lntop/ui/models&amp;#34;&lt;/span&gt;
</code></pre>
<p>)</p>
<p>const (
TRANSACTION = "transaction"
TRANSACTION_HEADER = "transaction_header"
TRANSACTION_FOOTER = "transaction_footer"
)</p>
<p>type Transaction struct {
view <em>gocui.View
transactions </em>models.Transactions
}</p>
<p>func (c Transaction) Name() string {
return TRANSACTION
}</p>
<p>func (c Transaction) Empty() bool {
return c.transactions == nil
}</p>
<p>func (c <em>Transaction) Wrap(v </em>gocui.View) View {
c.view = v
return c
}</p>
<p>func (c Transaction) Origin() (int, int) {
return c.view.Origin()
}</p>
<p>func (c Transaction) Cursor() (int, int) {
return c.view.Cursor()
}</p>
<p>func (c Transaction) Speed() (int, int, int, int) {
return 1, 1, 1, 1
}</p>
<p>func (c *Transaction) SetCursor(x, y int) error {
return c.view.SetCursor(x, y)
}</p>
<p>func (c *Transaction) SetOrigin(x, y int) error {
return c.view.SetOrigin(x, y)
}</p>
<p>func (c <em>Transaction) Set(g </em>gocui.Gui, x0, y0, x1, y1 int) error {
header, err := g.SetView(TRANSACTION_HEADER, x0-1, y0, x1+2, y0+2)
if err != nil {
if err != gocui.ErrUnknownView {
return err
}
}
header.Frame = false
header.BgColor = gocui.ColorGreen
header.FgColor = gocui.ColorBlack | gocui.AttrBold
header.Clear()
fmt.Fprintln(header, "Transaction")</p>
<pre><code>&lt;span style=&quot;color:#a6e22e&quot;&gt;v&lt;/span&gt;, &lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;:=&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;g&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;SetView&lt;/span&gt;(&lt;span style=&quot;color:#a6e22e&quot;&gt;TRANSACTION&lt;/span&gt;, &lt;span style=&quot;color:#a6e22e&quot;&gt;x0&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;-&lt;/span&gt;&lt;span style=&quot;color:#ae81ff&quot;&gt;1&lt;/span&gt;, &lt;span style=&quot;color:#a6e22e&quot;&gt;y0&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color:#ae81ff&quot;&gt;1&lt;/span&gt;, &lt;span style=&quot;color:#a6e22e&quot;&gt;x1&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color:#ae81ff&quot;&gt;2&lt;/span&gt;, &lt;span style=&quot;color:#a6e22e&quot;&gt;y1&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;-&lt;/span&gt;&lt;span style=&quot;color:#ae81ff&quot;&gt;1&lt;/span&gt;)
&lt;span style=&quot;color:#66d9ef&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;!=&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;nil&lt;/span&gt; {
	&lt;span style=&quot;color:#66d9ef&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;!=&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;gocui&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;ErrUnknownView&lt;/span&gt; {
		&lt;span style=&quot;color:#66d9ef&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt;
	}
}
&lt;span style=&quot;color:#a6e22e&quot;&gt;v&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Frame&lt;/span&gt; = &lt;span style=&quot;color:#66d9ef&quot;&gt;false&lt;/span&gt;
&lt;span style=&quot;color:#a6e22e&quot;&gt;c&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;view&lt;/span&gt; = &lt;span style=&quot;color:#a6e22e&quot;&gt;v&lt;/span&gt;
&lt;span style=&quot;color:#a6e22e&quot;&gt;c&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;display&lt;/span&gt;()

&lt;span style=&quot;color:#a6e22e&quot;&gt;footer&lt;/span&gt;, &lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;:=&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;g&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;SetView&lt;/span&gt;(&lt;span style=&quot;color:#a6e22e&quot;&gt;TRANSACTION_FOOTER&lt;/span&gt;, &lt;span style=&quot;color:#a6e22e&quot;&gt;x0&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;-&lt;/span&gt;&lt;span style=&quot;color:#ae81ff&quot;&gt;1&lt;/span&gt;, &lt;span style=&quot;color:#a6e22e&quot;&gt;y1&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;-&lt;/span&gt;&lt;span style=&quot;color:#ae81ff&quot;&gt;2&lt;/span&gt;, &lt;span style=&quot;color:#a6e22e&quot;&gt;x1&lt;/span&gt;, &lt;span style=&quot;color:#a6e22e&quot;&gt;y1&lt;/span&gt;)
&lt;span style=&quot;color:#66d9ef&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;!=&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;nil&lt;/span&gt; {
	&lt;span style=&quot;color:#66d9ef&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;!=&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;gocui&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;ErrUnknownView&lt;/span&gt; {
		&lt;span style=&quot;color:#66d9ef&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt;
	}
}
&lt;span style=&quot;color:#a6e22e&quot;&gt;footer&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Frame&lt;/span&gt; = &lt;span style=&quot;color:#66d9ef&quot;&gt;false&lt;/span&gt;
&lt;span style=&quot;color:#a6e22e&quot;&gt;footer&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;BgColor&lt;/span&gt; = &lt;span style=&quot;color:#a6e22e&quot;&gt;gocui&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;ColorCyan&lt;/span&gt;
&lt;span style=&quot;color:#a6e22e&quot;&gt;footer&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;FgColor&lt;/span&gt; = &lt;span style=&quot;color:#a6e22e&quot;&gt;gocui&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;ColorBlack&lt;/span&gt;
&lt;span style=&quot;color:#a6e22e&quot;&gt;footer&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Clear&lt;/span&gt;()
&lt;span style=&quot;color:#a6e22e&quot;&gt;blackBg&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;:=&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;color&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Black&lt;/span&gt;(&lt;span style=&quot;color:#a6e22e&quot;&gt;color&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Background&lt;/span&gt;)
&lt;span style=&quot;color:#a6e22e&quot;&gt;fmt&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Fprintln&lt;/span&gt;(&lt;span style=&quot;color:#a6e22e&quot;&gt;footer&lt;/span&gt;, &lt;span style=&quot;color:#a6e22e&quot;&gt;fmt&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Sprintf&lt;/span&gt;(&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;%s%s %s%s %s%s %s%s&amp;#34;&lt;/span&gt;,
	&lt;span style=&quot;color:#a6e22e&quot;&gt;blackBg&lt;/span&gt;(&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;F1&amp;#34;&lt;/span&gt;), &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;Help&amp;#34;&lt;/span&gt;,
	&lt;span style=&quot;color:#a6e22e&quot;&gt;blackBg&lt;/span&gt;(&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;F2&amp;#34;&lt;/span&gt;), &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;Menu&amp;#34;&lt;/span&gt;,
	&lt;span style=&quot;color:#a6e22e&quot;&gt;blackBg&lt;/span&gt;(&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;Enter&amp;#34;&lt;/span&gt;), &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;Transactions&amp;#34;&lt;/span&gt;,
	&lt;span style=&quot;color:#a6e22e&quot;&gt;blackBg&lt;/span&gt;(&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;F10&amp;#34;&lt;/span&gt;), &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;Quit&amp;#34;&lt;/span&gt;,
))
&lt;span style=&quot;color:#66d9ef&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;nil&lt;/span&gt;
</code></pre>
<p>}</p>
<p>func (c Transaction) Delete(g *gocui.Gui) error {
err := g.DeleteView(TRANSACTION_HEADER)
if err != nil {
return err
}</p>
<pre><code>&lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt; = &lt;span style=&quot;color:#a6e22e&quot;&gt;g&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;DeleteView&lt;/span&gt;(&lt;span style=&quot;color:#a6e22e&quot;&gt;TRANSACTION&lt;/span&gt;)
&lt;span style=&quot;color:#66d9ef&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;!=&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;nil&lt;/span&gt; {
	&lt;span style=&quot;color:#66d9ef&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt;
}

&lt;span style=&quot;color:#66d9ef&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;g&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;DeleteView&lt;/span&gt;(&lt;span style=&quot;color:#a6e22e&quot;&gt;TRANSACTION_FOOTER&lt;/span&gt;)
</code></pre>
<p>}</p>
<p>func (c *Transaction) display() {
p := message.NewPrinter(language.English)
v := c.view
v.Clear()
transaction := c.transactions.Current()
green := color.Green()
cyan := color.Cyan()
fmt.Fprintln(v, green(" [ Transaction ]"))
fmt.Fprintln(v, fmt.Sprintf("%s %s",
cyan(" Date:"), transaction.Date.Format("15:04:05 Jan _2")))
fmt.Fprintln(v, p.Sprintf("%s %d",
cyan(" Amount:"), transaction.Amount))
fmt.Fprintln(v, p.Sprintf("%s %d",
cyan(" Fee:"), transaction.TotalFees))
fmt.Fprintln(v, p.Sprintf("%s %d",
cyan(" BlockHeight:"), transaction.BlockHeight))
fmt.Fprintln(v, p.Sprintf("%s %d",
cyan("NumConfirmations:"), transaction.NumConfirmations))
fmt.Fprintln(v, p.Sprintf("%s %s",
cyan(" BlockHash:"), transaction.BlockHash))
fmt.Fprintln(v, fmt.Sprintf("%s %s",
cyan(" TxHash:"), transaction.TxHash))
fmt.Fprintln(v, "")
fmt.Fprintln(v, green("[ addresses ]"))
for i := range transaction.DestAddresses {
fmt.Fprintln(v, fmt.Sprintf("%s %s",
cyan(" -"), transaction.DestAddresses[i]))
}</p>
<p>}</p>
<p>func NewTransaction(transactions <em>models.Transactions) </em>Transaction {
return &Transaction{transactions: transactions}
}</p>
<p></p>
<hr>
<section data-noprocess data-shortcode-slide data-background-iframe=https://tippin.me/@edouardparis>
</section>
</div>
</div>
<script type=text/javascript src=/reveal-hugo/object-assign.js></script>
<a href=/reveal-js/css/print/ id=print-location style=display:none></a>
<script type=text/javascript>var printLocationElement=document.getElementById('print-location'),link=document.createElement('link');link.rel='stylesheet',link.type='text/css',link.href=printLocationElement.href+(window.location.search.match(/print-pdf/gi)?'pdf.css':'paper.css'),document.getElementsByTagName('head')[0].appendChild(link)</script>
<script type=application/json id=reveal-hugo-site-params>null</script>
<script type=application/json id=reveal-hugo-page-params>{"custom_theme":"css/slides.css","highlight_theme":"vs"}</script>
<script src=/reveal-js/lib/js/head.min.js></script>
<script src=/reveal-js/js/reveal.js></script>
<script type=text/javascript>var revealHugoDefaults,revealHugoSiteParams,revealHugoPageParams,options;function camelize(a){return a&&Object.keys(a).forEach(function(b){newK=b.replace(/(\_\w)/g,function(a){return a[1].toUpperCase()}),newK!=b&&(a[newK]=a[b],delete a[b])}),a}revealHugoDefaults={center:!0,controls:!0,history:!0,progress:!0,transition:"slide"},revealHugoSiteParams=JSON.parse(document.getElementById('reveal-hugo-site-params').innerHTML),revealHugoPageParams=JSON.parse(document.getElementById('reveal-hugo-page-params').innerHTML),options=Object.assign({},camelize(revealHugoDefaults),camelize(revealHugoSiteParams),camelize(revealHugoPageParams)),Reveal.initialize(options)</script>
<script type=text/javascript src=/reveal-js/lib/js/classList.js></script>
<script type=text/javascript src=/reveal-js/plugin/markdown/marked.js></script>
<script type=text/javascript src=/reveal-js/plugin/markdown/markdown.js></script>
<script type=text/javascript src=/reveal-js/plugin/highlight/highlight.js></script>
<script type=text/javascript src=/reveal-js/plugin/zoom-js/zoom.js></script>
<script type=text/javascript src=/reveal-js/plugin/notes/notes.js></script>
<script type=text/javascript>hljs&&hljs.initHighlightingOnLoad()</script>
</body>
</html>